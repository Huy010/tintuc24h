USER_UPDATE_NEWS__QUEUE={};const USER_UPDATE_NEWS__QUEUE__MAX_LENGTH=10;function user_submit_update_news(a,b,c,d){if("function"!=typeof user_check_login_status||!user_check_login_status(!0))return!1;if(c="undefined"==typeof c||""==c?"view":c,!["view","save"].includes(c))return!1;if(d="undefined"==typeof d||""==d?"update":d,!["update","delete"].includes(d))return!1;if(("undefined"==typeof a||""==a)&&(a=0),a=parseInt(a),isNaN(a)&&(a=0),"update"==d&&0>=a)return!1;b=parseInt(b),isNaN(b)&&(b=0);var e=user_get_submit_domain(),f={news_id:a,row_id:b,data_type:c,act_type:d},g="view"!=c||"update"!=d,h=!!("update"==d&&(0<a||0<b));$.ajax({url:e+"/ajax/user_update_news/act_update_news",type:"POST",data:f,success:function(e){var j={};if("object"==typeof e)j=e;else if("string"==typeof e)try{j=JSON.parse(e)}catch(a){}var k="object"==typeof j?Object.keys(j).length:0;if(0==k||"undefined"==typeof j.error){var l="L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh";return(console.log("user_submit_update_news",l,f),!g)?void 0:void(document.getElementById("popup_save_news_result")?user_show_popup_save_news_result(l,!0,!1,!1):alert(l))}var l="";if("undefined"!=typeof j.message&&""!=j.message?l=j.message:"undefined"!=typeof j.code&&""!=j.code&&(l=j.code),1==j.error&&(h=!1),1==j.error&&"undefined"!=typeof j.code&&""!=j.code&&"not_logged_in"==j.code)return user_update_news_add_queue(a,b,c,d),void(g&&"function"==typeof user_show_login_popup?user_show_login_popup():g&&(document.getElementById("popup_save_news_result")?user_show_popup_save_news_result(l,!0,!1,h):alert(l)));switch(c+"+++"+d){case"view+++update":break;case"view+++delete":if(1==j.error?""==l&&"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh"==l:(l="X\xF3a b\xE0i vi\u1EBFt \u0111\xE3 xem th\xE0nh c\xF4ng",0>=a&&0>=b&&(l="X\xF3a to\xE0n b\u1ED9 b\xE0i vi\u1EBFt \u0111\xE3 xem th\xE0nh c\xF4ng")),g)if(document.getElementById("popup_save_news_result")){user_show_popup_save_news_result(l,1==j.error,0>=a&&0>=b,h);break}else alert(l);0>=a&&0>=b&&window.location.reload();break;case"save+++update":if(1==j.error?""==l&&"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh"==l:l="L\u01B0u b\xE0i vi\u1EBFt th\xE0nh c\xF4ng",0<a){var m=document.getElementsByClassName("btn-save-news-"+a);if(0<m.length)for(let a=0;a<m.length;++a)m[a].classList.remove("unsave"),m[a].classList.add("saved")}g&&(document.getElementById("popup_save_news_result")?user_show_popup_save_news_result(l,1==j.error,!1,h):alert(l));break;case"save+++delete":if(1==j.error?""==l&&"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh"==l:(l="B\u1ECF l\u01B0u b\xE0i vi\u1EBFt th\xE0nh c\xF4ng",0>=a&&0>=b&&(l="B\u1ECF l\u01B0u to\xE0n b\u1ED9 b\xE0i vi\u1EBFt th\xE0nh c\xF4ng")),0<a){var m=document.getElementsByClassName("btn-save-news-"+a);if(0<m.length)for(let a=0;a<m.length;++a)m[a].classList.add("unsave"),m[a].classList.remove("saved");var n=document.getElementsByClassName("user-news-saved-"+a);if(0<n.length)for(let a=n.length-1;0<=a;--a)n[a].parentNode.removeChild(n[a])}if(g)if(document.getElementById("popup_save_news_result")){user_show_popup_save_news_result(l,1==j.error,0>=a&&0>=b,h);break}else alert(l);0>=a&&0>=b&&window.location.reload();}if(1!=j.error&&"undefined"!=typeof j.total_news&&-1<j.total_news){var o="";if("view"===c?o="fe-user-total-viewed":"save"===c?o="fe-user-total-saved":void 0,""!=o){var p=document.getElementsByClassName(o);if(0<p.length)for(let a=0;a<p.length;++a)p[a].textContent=j.total_news}}},error:function(a,b,c){if(console.log("user_submit_update_news","L\u1ED7i ajax",f,a,b,c),!!g){document.getElementById("popup_save_news_result")?user_show_popup_save_news_result("L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh",!0,!1,!1):alert("L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh")}}})}function user_update_news_add_queue(a,b,c,d){USER_UPDATE_NEWS__QUEUE[a+"+++"+b+"+++"+c+"+++"+d]={news_id:a,row_id:b,data_type:c,act_type:d};var e=Object.keys(USER_UPDATE_NEWS__QUEUE);if(e.length>USER_UPDATE_NEWS__QUEUE__MAX_LENGTH)for(let a=0;a<e.length-USER_UPDATE_NEWS__QUEUE__MAX_LENGTH;a++)delete USER_UPDATE_NEWS__QUEUE[e[a]]}function user_update_news_submit_queue(){var a=0;for(var b of Object.keys(USER_UPDATE_NEWS__QUEUE)){var c=USER_UPDATE_NEWS__QUEUE[b];if("object"!=typeof c||"undefined"==typeof c.news_id||"undefined"==typeof c.row_id||"undefined"==typeof c.data_type||"undefined"==typeof c.act_type){delete USER_UPDATE_NEWS__QUEUE[b];continue}if(user_submit_update_news(c.news_id,c.row_id,c.data_type,c.act_type),delete USER_UPDATE_NEWS__QUEUE[b],++a,a>=USER_UPDATE_NEWS__QUEUE__MAX_LENGTH){USER_UPDATE_NEWS__QUEUE=[];break}}}function user_update_news(a,b,c){if("undefined"==typeof a||""==a)return!1;if(a=parseInt(a),isNaN(a)||0>=a)return!1;if(b="undefined"==typeof b||""==b?"view":b,!["view","save"].includes(b))return!1;var d="update";"save"==b&&c&&!c.classList.contains("unsave")&&(d="delete"),"function"==typeof user_check_login_status&&user_check_login_status(!0)?user_submit_update_news(a,0,b,d):(user_update_news_add_queue(a,0,b,d),"save"==b&&"function"==typeof user_show_login_popup&&user_show_login_popup())}function user_remove_news_saved_sign(){var a=document.getElementsByClassName("btn-save-news");if(0<a.length)for(let b=0;b<a.length;++b)a[b].classList.add("unsave"),a[b].classList.remove("saved")}function user_check_news_saved(a){if("function"!=typeof user_check_login_status||!user_check_login_status(!0))return!1;if("undefined"==typeof a||""==a.trim()){a=[];var b=document.getElementsByClassName("btn-save-news");if(0<b.length)for(let d=0;d<b.length;++d)if(!b[d].classList.contains("saved-checked")){var c=b[d].getAttribute("data-news_id");"undefined"!=typeof c&&""!=c.trim()&&(c=parseInt(c),!(isNaN(c)||0>=c))&&(a.includes(c)||a.push(c))}a=a.join(",")}else a=a.trim();if(""==a)return!1;var d={news_ids:a},e=get_location_base_url();$.ajax({url:e+"/ajax/user_update_news/check_news_saved",type:"POST",data:d,success:function(a){var b={};if("object"==typeof a)b=a;else if("string"==typeof a)try{b=JSON.parse(a)}catch(a){}var c="object"==typeof b?Object.keys(b).length:0;if(0!=c)for(var d of Object.keys(b)){var e=b[d];if("undefined"!=typeof e&&!("string"==typeof e&&(e=parseInt(e),isNaN(e)||0>=e))&&"number"==typeof e){var f=document.getElementsByClassName("btn-save-news-"+e);if(0<f.length)for(let a=0;a<f.length;++a)f[a].classList.remove("unsave"),f[a].classList.add("saved")}}}})}function user_show_popup_save_news_result(a,b,c,d){var e=document.getElementById("popup_save_news_result");if(e){"function"==typeof user_hide_popup_confirm_delete_all&&user_hide_popup_confirm_delete_all(),e.setAttribute("reload-after-close","undefined"!=typeof c&&c?1:0);var f=e.getElementsByClassName("result-mes");0<f.length&&(f[0].textContent=a,"undefined"!=typeof b&&b?f[0].classList.add("color-red"):f[0].classList.remove("color-red"));var g=e.getElementsByClassName("result-des");0<g.length&&("undefined"!=typeof d&&d?g[0].classList.remove("d-none"):g[0].classList.add("d-none")),e.closest(".podcasts-eva-t")&&e.closest(".podcasts-eva-t").classList.add("show-child-pos-fixed"),e.classList.add("d-flex"),e.classList.remove("d-none")}}function user_hide_popup_save_news_result(){var a=document.getElementById("popup_save_news_result");if(a){a.classList.add("d-none"),a.classList.remove("d-flex"),a.closest(".podcasts-eva-t")&&a.closest(".podcasts-eva-t").classList.remove("show-child-pos-fixed");var b=a.getAttribute("reload-after-close");1==b&&window.location.reload()}}